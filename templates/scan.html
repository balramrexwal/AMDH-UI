{% extends 'layout.html' %}

{% block body %}
{% if scan == "apps_scan" %}
<div  class="jumbotron text-center p-3 bg-gradient-dark text-white">
    <h3> Packages List </h3>
    <h5> Device : {{ device }}</h5>
    <h6> {% if app_type == '3' %} Third party {% elif app_type == 'e' %} Enabled {% elif app_type == 'd' %} Disabled {% elif app_type == 's' %} System {% endif %} Apps</h6>
</div>

<div class="jumbotron text-center p-3 bg-gradient-dark text-white"  >
    <table class="table bg-gradient-info" style="justify-content: space-around">
        <thead class="thead-dark ">
        <tr class=".bg-primary">
            <th class="p-3 mb-2 bg-gradient-dark text-white" scope="col">#</th>
            <th scope="col p-3 mb-2  text-white" ><center>Package</center></th>
            <th scope="col p-3 mb-2  text-white" ><center>Admin check</center></th>
            <th scope="col p-3 mb-2  text-white" ><center>Malware Permissions</center></th>
            <th scope="col p-3 mb-2  text-white" ><center>Malware Score</center></th>
        </tr>
        </thead>
        <tbody>
        {% for package in packages.keys() %}
        {% if packages[package]['dangerous']|length != 0 %}<tr class="bg-danger">{% else %} <tr>{% endif %}

            <td class="p-3 mb-2 bg-gradient-dark text-gray-400" scope="row">  {{ loop.index }}</td>

            <td class="p-3 mb-2" ><a class="text-gray-400" href="/application/{{ device }}/{{ app_type }}/{{ show }}/{{ package }}">{{ package }}</a> </td>
            {% if packages[package]['isAdmin'] == True %}
            <form action="{{ url_for('app_action', app_type=app_type, show=show, device=device, package=package)}}" method="post">
                <td class="p-3 mb-2" ><button type="submit" name="action" value="rm_admin" class="btn btn-danger btn-circle"><i class="fas fa-trash"></i></button></td>
            </form>
            {% else %}

            <td class="p-3 mb-2" ><a class="btn btn-success btn-circle text-gray-900">None</a></td>
            {% endif %}
            <td class="p-3 mb-2" >
                {% if packages[package]['mal_confidence'] > 0 %}
                <a class="btn btn-success btn-circle text-gray-900"><i class="fas fa-check" ></i></a>
                {% else %}
                <a class="btn btn-warning btn-circle text-gray-900"><i class="fas fa-exclamation-triangle"></i></a>
                {% endif %}
            </td>
            <td>
                {% if packages[package]['mal_score'] >= 0 %}
                <a class="btn btn-success btn-circle text-gray-900"><i class="fas fa-check" ></i></a>
                {% else %}
                <a class="btn btn-warning btn-circle text-gray-900"><i class="fas fa-exclamation-triangle"></i></a>
                {% endif %}
            </td>
        </tr>

        {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div  class="jumbotron text-center p-3 bg-gradient-dark text-white">
    <h3> Settings List </h3>
    <h5> Device : {{ device }}</h5>
</div>
<div class="jumbotron bg-gray-700 "  >
    <table class="table" style="justify-content: space-around">
        <thead class="thead-dark ">
        <tr class="bg-primary">
            <th class="p-3 mb-2 bg-gradient-dark text-white" scope="col">Section</th>
            <th class="p-3 mb-2 bg-gray-600 text-white" scope="row" scope="col" ><center>Key</center></th>
            <th  class="p-3 mb-2 bg-gray-600 text-white" scope="row" scope="col" ><center>Current</center></th>
            <th class="p-3 mb-2 bg-gray-600 text-white" scope="row" scope="col" ><center>expected</center></th>
        </tr>
        </thead>
        <tbody>
        {% for key,value in global_result.items() %}

        <tr>
            <th class="p-3 mb-2 bg-gradient-dark text-white" scope="row">  global </th>
            <th class="p-3 mb-2 bg-gray-400 text-gray-900" scope="row">  {{ key }} </th>
            {% if value['current'] != value['expected'] %}
            <th class="bg-warning " scope="row">
                {% else %}
            <th class="bg-success " scope="row"> {% endif %} {{ value['current'] }} </th>
            <th  class="p-3 mb-2 bg-gray-400 text-gray-900" scope="row">  {{ value['expected'] }}</th>
        </tr>


        {% endfor %}
        {% for key,value in secure_result.items() %}

        <tr>
            <th class="p-3 mb-2 bg-gradient-dark text-white" scope="row">  secure </th>
            <th class="p-3 mb-2 bg-gray-400 text-gray-900"scope="row">  {{ key }} </th>
            {% if value['current'] != value['expected'] %}
            <th class="p-3 mb-2 text-gray-900 bg-warning " scope="row">
                {% else %}
            <th class="p-3 mb-2 text-gray-900 bg-success " scope="row"> {% endif %} {{ value['current'] }} </th>
            <th  class="p-3 mb-2 bg-gray-400 text-gray-900" scope="row">  {{ value['expected'] }}</th>
        </tr>


        {% endfor %}
        </tbody>
    </table>
    <form action="{{ url_for('harden_settings', device=device) }}" method="post">
        <div class="form-group">
            <div class="col text-center text-white-50 ">
                <button type="submit"  value="harden" class="btn btn-success text-gray-900" >Harden</button>
            </div>
        </div>
    </form>
    {% endif%}


</div>


{% endblock %}